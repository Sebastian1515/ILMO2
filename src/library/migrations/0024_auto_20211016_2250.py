# Generated by Django 3.2.8 on 2021-10-16 20:50

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion

def migrate_to_member(apps, schema_editor):
    Member = apps.get_model("library", "Member")
    Language = apps.get_model("library", "Language")
    lang = Language.objects.create(name="english")
    User = apps.get_model("auth", "User")
    for user in User.objects.all()[1:]:
        new_member = Member.objects.create(user=user,
                                           preferred_language=lang)
def remigrate_to_user(apps, schema_editor):
    Member = apps.get_model("library", "Member")
    Member.objects.all().delete()

class Migration(migrations.Migration):

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('library', '0023_alter_loan_options'),
    ]

    operations = [
        migrations.AlterField(
            model_name='language',
            name='name',
            field=models.CharField(help_text='Enter a natural languages name (e.g. English, French, Japanese etc.)', max_length=200),
        ),
        migrations.CreateModel(
            name='Member',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('preferred_language', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='library.language')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.RunPython(migrate_to_member, remigrate_to_user),
    ]
